<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="BlackJackCamera.CameraPage"
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="Transparent">

  <Grid RowDefinitions="Auto,*,Auto">

    <!-- CameraView (Camera.MAUI) -->
    <toolkit:CameraView x:Name="cameraView"
                  Grid.RowSpan="3"
                  HorizontalOptions="FillAndExpand"
                  MediaCaptured="OnMediaCaptured"
                  VerticalOptions="FillAndExpand"
                  ZoomFactor="1"/>

    <!-- Замороженное изображение и затемнение на весь экран -->
    <Image x:Name="FrozenImage"
           Grid.RowSpan="3"
           Aspect="AspectFill"
           HorizontalOptions="FillAndExpand"
           VerticalOptions="FillAndExpand"
           IsVisible="False"/>

    <Border x:Name="DarkOverlay"
            Grid.RowSpan="3"
            HorizontalOptions="FillAndExpand"
            VerticalOptions="FillAndExpand"
            IsVisible="False"
            BackgroundColor="Transparent">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
          <GradientStop Color="#70000000" Offset="0.0" />
          <GradientStop Color="#60222222" Offset="0.5" />
          <GradientStop Color="#70000000" Offset="1.0" />
        </LinearGradientBrush>
      </Border.Background>
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="0"/>
      </Border.StrokeShape>
      <Border.GestureRecognizers>
        <TapGestureRecognizer Tapped="OnOverlayTapped"/>
      </Border.GestureRecognizers>
    </Border>

    <ActivityIndicator x:Name="LoadingIndicator"
                      Grid.RowSpan="3"
                      HorizontalOptions="Center"
                      VerticalOptions="Center"
                      Color="White"
                      WidthRequest="60"
                      HeightRequest="60"
                      IsRunning="False"
                      IsVisible="False"/>

    <!-- TOP BAR -->
    <Grid Grid.Row="0" Padding="16,12,16,8" ColumnDefinitions="Auto,*,Auto" BackgroundColor="Transparent">
      <ImageButton Source="CameraPage/icon_back.svg" BackgroundColor="Transparent" Clicked="OnBackClicked" WidthRequest="28" HeightRequest="28"/>
      <Label Grid.Column="1" Text="Умная камера" HorizontalOptions="Center" VerticalOptions="Center" TextColor="White" FontSize="18" FontAttributes="Bold" BackgroundColor="Transparent"/>
      <ImageButton Grid.Column="2" Source="CameraPage/icon_info.svg" BackgroundColor="Transparent" Clicked="OnInfoClicked" WidthRequest="28" HeightRequest="28"/>
    </Grid>

    <!-- OVERLAYS -->
    <Grid Grid.Row="1" BackgroundColor="Transparent">

      <!-- Overlays -->
      <AbsoluteLayout>

        <!-- угловые элементы (вырезанные PNG) -->
        <Image x:Name="Corner1" Source="CameraPage/corner_tl.svg" AbsoluteLayout.LayoutBounds="0.06,0.08,72,72" AbsoluteLayout.LayoutFlags="PositionProportional"/>
        <Image x:Name="Corner2" Source="CameraPage/corner_tr.svg" AbsoluteLayout.LayoutBounds="0.94,0.08,72,72" AbsoluteLayout.LayoutFlags="PositionProportional"/>
        <Image x:Name="Corner3" Source="CameraPage/corner_bl.svg" AbsoluteLayout.LayoutBounds="0.06,0.92,72,72" AbsoluteLayout.LayoutFlags="PositionProportional"/>
        <Image x:Name="Corner4" Source="CameraPage/corner_br.svg" AbsoluteLayout.LayoutBounds="0.94,0.92,72,72" AbsoluteLayout.LayoutFlags="PositionProportional"/>

        <!-- подсказка (внизу поверх preview) -->
        <Frame x:Name="HintPill"
                AbsoluteLayout.LayoutBounds="0.5,0.78,0.86,-1"
                AbsoluteLayout.LayoutFlags="PositionProportional,WidthProportional"
                BackgroundColor="#55444444"
                CornerRadius="21"
                Padding="12,6"
                HasShadow="False"
                HorizontalOptions="Center">
            <Label Text="Распознаём автомобили, компьютерную технику и многое другое"
                   TextColor="#E6E6E6"
                   FontSize="14"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   HorizontalTextAlignment="Center"
                   VerticalTextAlignment="Center"
                   LineBreakMode="WordWrap"
                   BackgroundColor="Transparent"/>
        </Frame>

        <!-- pill с результатом (скрыт по умолчанию) -->
        <Frame x:Name="RecognitionPill"
               AbsoluteLayout.LayoutBounds="0.5,0.65,0.6,-1"
               AbsoluteLayout.LayoutFlags="PositionProportional,WidthProportional"
               BackgroundColor="#CC1F2937" CornerRadius="22"
               Padding="12,6" HasShadow="False" IsVisible="False">
          <Label x:Name="RecognitionLabel" TextColor="White" FontSize="15" HorizontalOptions="Center" VerticalOptions="Center" BackgroundColor="Transparent"/>
        </Frame>

      </AbsoluteLayout>
    </Grid>

    <!-- BOTTOM BAR -->
    <Grid Grid.Row="2" Padding="20,12" ColumnDefinitions="Auto,*,Auto" BackgroundColor="Transparent">
      <ImageButton Source="CameraPage/icon_gallery.svg" BackgroundColor="Transparent" Clicked="OnGalleryClicked" WidthRequest="25" HeightRequest="25" HorizontalOptions="Start" VerticalOptions="Center"/>

      <!-- центральная кнопка захвата -->
      <Grid Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Center" HeightRequest="70" WidthRequest="70" BackgroundColor="Transparent">
        <Frame CornerRadius="44" BackgroundColor="Transparent" BorderColor="White" HasShadow="True">
             <Button x:Name="ShutterButton" BackgroundColor="#F2F2F2" CornerRadius="30" HeightRequest="56" WidthRequest="56" Clicked="OnCaptureButtonClicked" HorizontalOptions="Fill" VerticalOptions="Fill"/>
        </Frame>
      </Grid>

      <ImageButton x:Name="FlashButton"
                   Grid.Column="2"
                   Source="CameraPage/icon_flash_off.svg"
                   BackgroundColor="Transparent"
                   Clicked="OnFlashClicked"
                   WidthRequest="28"
                   HeightRequest="28"
                   HorizontalOptions="End"
                   VerticalOptions="Center"/>
    </Grid>

    <!-- Bottom Sheet с бейджами (в конце, чтобы рисовался поверх всех элементов) -->
    <Border x:Name="BottomSheet"
            Grid.RowSpan="3"
            VerticalOptions="End"
            HorizontalOptions="Fill"
            Margin="-1,0,-1,0"
            IsVisible="False">
      <Border.Background>
        <!-- Тройной градиент как у One UI -->
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
          <GradientStop Color="#1B1B1C" Offset="0.0" /> 
          <GradientStop Color="#883A3A3D" Offset="1.0" /> 
        </LinearGradientBrush>
      </Border.Background>
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="28,28,0,0"/>
      </Border.StrokeShape>
      <Border.Shadow>
        <Shadow Brush="Black" Offset="0,-8" Radius="32" Opacity="0.6"/>
      </Border.Shadow>

      <Grid RowDefinitions="Auto,Auto" Padding="0">
        <!-- Gesture recognizer для свайпа вниз -->
        <Grid.GestureRecognizers>
          <SwipeGestureRecognizer Direction="Down" Swiped="OnBottomSheetSwipedDown"/>
        </Grid.GestureRecognizers>

        <!-- Полоска для захвата (Handle) как у One UI -->
        <BoxView Grid.Row="0"
                 WidthRequest="48"
                 HeightRequest="4"
                 BackgroundColor="#60FFFFFF"
                 CornerRadius="2"
                 Margin="0,16,0,20"
                 HorizontalOptions="Center"/>

        <!-- Контейнер с бейджами (без ScrollView, чтобы подстраивался под контент) -->
        <FlexLayout Grid.Row="1"
                    x:Name="BadgesContainer"
                    Direction="Row"
                    Wrap="Wrap"
                    JustifyContent="Start"
                    AlignItems="Start"
                    AlignContent="Start"
                    Padding="20,0,20,28"/>
      </Grid>
    </Border>

    <!-- Credit Offer Modal (поверх всех элементов) -->
    <Border x:Name="CreditOfferModal"
            Grid.RowSpan="3"
            VerticalOptions="End"
            HorizontalOptions="Fill"
            Margin="-1,0,-1,0"
            IsVisible="False"
            BackgroundColor="#0B0B0C">
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="28,28,0,0"/>
      </Border.StrokeShape>
      <Border.Shadow>
        <Shadow Brush="Black" Offset="0,-8" Radius="32" Opacity="0.7"/>
      </Border.Shadow>

      <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="20,20,20,30">

        <!-- Полоска для захвата (Handle) -->
        <BoxView Grid.Row="0"
                 WidthRequest="48"
                 HeightRequest="4"
                 BackgroundColor="#60FFFFFF"
                 CornerRadius="2"
                 Margin="0,0,0,20"
                 HorizontalOptions="Center"/>

        <!-- Индикатор шагов -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*" ColumnSpacing="8" Margin="0,0,0,24">
          <Border Grid.Column="0">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <BoxView x:Name="Step1Indicator" BackgroundColor="#EF3124" HeightRequest="4" CornerRadius="2"/>
          </Border>

          <Border Grid.Column="1">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <BoxView x:Name="Step2Indicator" BackgroundColor="#2B2B2D" HeightRequest="4" CornerRadius="2"/>
          </Border>

          <Border Grid.Column="2">
            <Border.StrokeShape>
              <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <BoxView x:Name="Step3Indicator" BackgroundColor="#2B2B2D" HeightRequest="4" CornerRadius="2"/>
          </Border>
        </Grid>

        <!-- Контент шагов (Grid с переключением видимости) -->
        <Grid Grid.Row="2" VerticalOptions="FillAndExpand">

          <!-- ШАГ 1: Одобрение кредита -->
          <Grid x:Name="Step1Content" IsVisible="True">
                <ScrollView VerticalScrollBarVisibility="Never">
                  <StackLayout Spacing="20" VerticalOptions="Start" Padding="0,10">
                    <Label Text="Шаг 1 из 3"
                           TextColor="#8E8E93"
                           FontSize="14"
                           HorizontalTextAlignment="Center"/>

                    <Border WidthRequest="70"
                            HeightRequest="70"
                            HorizontalOptions="Center"
                            BackgroundColor="#1B3A1B">
                      <Border.StrokeShape>
                        <RoundRectangle CornerRadius="35"/>
                      </Border.StrokeShape>
                      <Label Text="✓"
                             TextColor="#4CAF50"
                             FontSize="42"
                             FontAttributes="Bold"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"/>
                    </Border>

                    <StackLayout Spacing="10">
                      <Label Text="Кредит предодобрен!"
                             TextColor="White"
                             FontSize="26"
                             FontAttributes="Bold"
                             HorizontalTextAlignment="Center"/>

                      <Label x:Name="OfferTextLabel"
                             Text="Вам предодобрен кредит на покупку ноутбука на сумму до 136 000 ₽"
                             TextColor="#E6E6E6"
                             FontSize="16"
                             LineBreakMode="WordWrap"
                             HorizontalTextAlignment="Center"
                             Margin="0,0,0,6"/>

                      <Label Text="Не упустите возможность и оформите прямо сейчас!"
                             TextColor="#8E8E93"
                             FontSize="14"
                             LineBreakMode="WordWrap"
                             HorizontalTextAlignment="Center"/>
                    </StackLayout>

                    <Border BackgroundColor="#141417"
                           Padding="16"
                           Margin="0,8,0,0">
                      <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                      </Border.StrokeShape>
                      <StackLayout Spacing="14">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                          <Label Grid.Column="0" Text="💳" FontSize="22"/>
                          <Label Grid.Column="1"
                                 Text="Без первоначального взноса"
                                 TextColor="White"
                                 FontSize="14"
                                 VerticalOptions="Center"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                          <Label Grid.Column="0" Text="⚡" FontSize="22"/>
                          <Label Grid.Column="1"
                                 Text="Решение за 2 минуты"
                                 TextColor="White"
                                 FontSize="14"
                                 VerticalOptions="Center"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                          <Label Grid.Column="0" Text="📱" FontSize="22"/>
                          <Label Grid.Column="1"
                                 Text="Оформление онлайн"
                                 TextColor="White"
                                 FontSize="14"
                                 VerticalOptions="Center"/>
                        </Grid>
                      </StackLayout>
                    </Border>
                  </StackLayout>
                </ScrollView>
          </Grid>

          <!-- ШАГ 2: Выбор суммы -->
          <Grid x:Name="Step2Content" IsVisible="False">
                <ScrollView VerticalScrollBarVisibility="Never">
                  <StackLayout Spacing="20" VerticalOptions="Start" Padding="0,10">
                    <Label Text="Шаг 2 из 3"
                           TextColor="#8E8E93"
                           FontSize="14"
                           HorizontalTextAlignment="Center"/>

                    <Label Text="Выберите сумму кредита"
                           TextColor="White"
                           FontSize="24"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"/>

                    <Border BackgroundColor="#141417"
                            Padding="20,16"
                            HorizontalOptions="Center">
                      <Border.StrokeShape>
                        <RoundRectangle CornerRadius="18"/>
                      </Border.StrokeShape>
                      <Border.Shadow>
                        <Shadow Brush="#EF3124" Offset="0,4" Radius="20" Opacity="0.3"/>
                      </Border.Shadow>

                      <StackLayout Spacing="6" HorizontalOptions="Center">
                        <Label x:Name="SelectedAmountLabel"
                               Text="75 000 ₽"
                               TextColor="#EF3124"
                               FontSize="36"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center"/>
                        <Label Text="Выбранная сумма"
                               TextColor="#8E8E93"
                               FontSize="12"
                               HorizontalTextAlignment="Center"/>
                      </StackLayout>
                    </Border>

                    <StackLayout Spacing="10" Margin="0,16,0,0">
                      <Slider x:Name="AmountSlider"
                              Minimum="15000"
                              Maximum="136000"
                              Value="75000"
                              MinimumTrackColor="#EF3124"
                              MaximumTrackColor="#2B2B2D"
                              ThumbColor="#EF3124"
                              ValueChanged="OnAmountChanged"/>

                      <Grid ColumnDefinitions="*,*" Margin="0,4,0,0">
                        <Label Grid.Column="0"
                               x:Name="MinAmountLabel"
                               Text="15 000 ₽"
                               TextColor="#8E8E93"
                               FontSize="12"
                               HorizontalOptions="Start"/>
                        <Label Grid.Column="1"
                               x:Name="MaxAmountLabel"
                               Text="136 000 ₽"
                               TextColor="#8E8E93"
                               FontSize="12"
                               HorizontalOptions="End"/>
                      </Grid>
                    </StackLayout>

                    <Border BackgroundColor="#141417"
                           Padding="16"
                           Margin="0,8,0,0">
                      <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                      </Border.StrokeShape>
                      <Grid RowDefinitions="Auto,Auto" RowSpacing="10">
                        <StackLayout Grid.Row="0" Orientation="Horizontal" HorizontalOptions="Center">
                          <Label Text="Ежемесячный платеж: "
                                 TextColor="#8E8E93"
                                 FontSize="14"/>
                          <Label x:Name="MonthlyPaymentLabel"
                                 Text="≈ 3 125 ₽"
                                 TextColor="White"
                                 FontSize="14"
                                 FontAttributes="Bold"/>
                        </StackLayout>

                        <Label Grid.Row="1"
                               Text="Срок: 24 месяца • Ставка: 14.9%"
                               TextColor="#8E8E93"
                               FontSize="12"
                               HorizontalTextAlignment="Center"/>
                      </Grid>
                    </Border>
                  </StackLayout>
                </ScrollView>
          </Grid>

          <!-- ШАГ 3: Подтверждение -->
          <Grid x:Name="Step3Content" IsVisible="False">
                <ScrollView VerticalScrollBarVisibility="Never">
                  <StackLayout Spacing="20" VerticalOptions="Start" Padding="0,10">
                    <Label Text="Шаг 3 из 3"
                           TextColor="#8E8E93"
                           FontSize="14"
                           HorizontalTextAlignment="Center"/>

                    <Border WidthRequest="70"
                            HeightRequest="70"
                            HorizontalOptions="Center"
                            BackgroundColor="#1B1B3A">
                      <Border.StrokeShape>
                        <RoundRectangle CornerRadius="35"/>
                      </Border.StrokeShape>
                      <Label Text="📤"
                             FontSize="38"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"/>
                    </Border>

                    <StackLayout Spacing="10">
                      <Label Text="Заявка принята!"
                             TextColor="White"
                             FontSize="26"
                             FontAttributes="Bold"
                             HorizontalTextAlignment="Center"/>

                      <Label Text="Ваша заявка будет рассмотрена в ближайшее время"
                             TextColor="#E6E6E6"
                             FontSize="16"
                             LineBreakMode="WordWrap"
                             HorizontalTextAlignment="Center"
                             Margin="0,0,0,6"/>

                      <Label Text="По готовности придет push-уведомление"
                             TextColor="#8E8E93"
                             FontSize="14"
                             LineBreakMode="WordWrap"
                             HorizontalTextAlignment="Center"/>
                    </StackLayout>

                    <Border BackgroundColor="#141417"
                           Padding="16"
                           Margin="0,8,0,0">
                      <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                      </Border.StrokeShape>
                      <StackLayout Spacing="12">
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                          <Label Grid.Column="0" Text="Номер заявки:" TextColor="#8E8E93" FontSize="13"/>
                          <Label Grid.Column="1" x:Name="ApplicationNumberLabel" Text="#2024-12345678" TextColor="White" FontSize="13" FontAttributes="Bold"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                          <Label Grid.Column="0" Text="Сумма кредита:" TextColor="#8E8E93" FontSize="13"/>
                          <Label Grid.Column="1" x:Name="FinalAmountLabel" Text="75 000 ₽" TextColor="White" FontSize="13" FontAttributes="Bold"/>
                        </Grid>

                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                          <Label Grid.Column="0" Text="Срок рассмотрения:" TextColor="#8E8E93" FontSize="13"/>
                          <Label Grid.Column="1" Text="до 30 минут" TextColor="White" FontSize="13" FontAttributes="Bold"/>
                        </Grid>
                      </StackLayout>
                    </Border>

                    <Label Text="Следить за статусом заявки можно в разделе 'Кредиты'"
                           TextColor="#8E8E93"
                           FontSize="12"
                           LineBreakMode="WordWrap"
                           HorizontalTextAlignment="Center"
                           Margin="0,8,0,0"/>
                  </StackLayout>
                </ScrollView>
          </Grid>

        </Grid>

        <!-- Кнопка действия -->
        <Button x:Name="CreditActionButton"
                Grid.Row="3"
                Text="Выбрать сумму"
                BackgroundColor="#EF3124"
                TextColor="White"
                FontSize="16"
                FontAttributes="Bold"
                CornerRadius="14"
                HeightRequest="52"
                Clicked="OnCreditActionButtonClicked"
                Margin="0,16,0,0"/>
      </Grid>
    </Border>

    <!-- Installment Offer Modal для телефонов (современный тёмный дизайн Альфа-Банка) -->
    <Border x:Name="InstallmentOfferModal"
            Grid.RowSpan="3"
            VerticalOptions="End"
            HorizontalOptions="Fill"
            Margin="-1,0,-1,0"
            IsVisible="False"
            BackgroundColor="#0B0B0C">
      <Border.StrokeShape>
        <RoundRectangle CornerRadius="32,32,0,0"/>
      </Border.StrokeShape>
      <Border.Shadow>
        <Shadow Brush="Black" Offset="0,-12" Radius="40" Opacity="0.15"/>
      </Border.Shadow>

      <Grid RowDefinitions="Auto,Auto,*,Auto" Padding="24,20,24,30">

        <!-- Полоска для захвата (Handle) -->
        <BoxView Grid.Row="0"
                 WidthRequest="48"
                 HeightRequest="4"
                 BackgroundColor="#60FFFFFF"
                 CornerRadius="2"
                 Margin="0,0,0,24"
                 HorizontalOptions="Center"/>

        <!-- Индикатор шагов (минималистичный) -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*" ColumnSpacing="6" Margin="0,0,0,28">
          <BoxView x:Name="InstallmentStep1Indicator" Grid.Column="0" BackgroundColor="#EF3124" HeightRequest="3" CornerRadius="1.5"/>
          <BoxView x:Name="InstallmentStep2Indicator" Grid.Column="1" BackgroundColor="#2B2B2D" HeightRequest="3" CornerRadius="1.5"/>
          <BoxView x:Name="InstallmentStep3Indicator" Grid.Column="2" BackgroundColor="#2B2B2D" HeightRequest="3" CornerRadius="1.5"/>
        </Grid>

        <!-- Контент шагов -->
        <Grid Grid.Row="2" VerticalOptions="FillAndExpand">

          <!-- ШАГ 1: Выбор срока рассрочки -->
          <Grid x:Name="InstallmentStep1Content" IsVisible="True">
            <ScrollView VerticalScrollBarVisibility="Never">
              <StackLayout Spacing="24" VerticalOptions="Start" Padding="0,0,0,20">

                <StackLayout Spacing="12">
                  <Label Text="Рассрочка 0%"
                         TextColor="White"
                         FontSize="28"
                         FontAttributes="Bold"
                         HorizontalTextAlignment="Center"/>

                  <Label Text="в Альфа-Маркете"
                         TextColor="#EF3124"
                         FontSize="20"
                         FontAttributes="Bold"
                         HorizontalTextAlignment="Center"
                         Margin="0,-8,0,0"/>

                  <Label x:Name="PhonePriceLabel"
                         Text="Телефон за 89 990 ₽"
                         TextColor="#8E8E93"
                         FontSize="15"
                         HorizontalTextAlignment="Center"
                         Margin="0,4,0,0"/>
                </StackLayout>

                <Label Text="Выберите срок рассрочки"
                       TextColor="#E6E6E6"
                       FontSize="16"
                       FontAttributes="Bold"
                       Margin="0,8,0,0"/>

                <!-- Карточки выбора срока -->
                <StackLayout Spacing="12">
                  <!-- 6 месяцев -->
                  <Border x:Name="Duration6Months"
                          BackgroundColor="#1B1B1C"
                          Padding="18,16"
                          HeightRequest="75">
                    <Border.StrokeShape>
                      <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                      <TapGestureRecognizer Tapped="OnDuration6MonthsTapped"/>
                    </Border.GestureRecognizers>
                    <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                      <StackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                        <Label Text="6 месяцев"
                               TextColor="White"
                               FontSize="17"
                               FontAttributes="Bold"/>
                        <Label x:Name="Monthly6Label"
                               Text="≈ 14 998 ₽/мес"
                               TextColor="#8E8E93"
                               FontSize="14"/>
                      </StackLayout>
                      <Label Grid.Column="1"
                             x:Name="Check6Months"
                             Text="○"
                             TextColor="#3D3D3D"
                             FontSize="28"
                             VerticalOptions="Center"/>
                    </Grid>
                  </Border>

                  <!-- 12 месяцев -->
                  <Border x:Name="Duration12Months"
                          BackgroundColor="#1B1B1C"
                          Padding="18,16"
                          HeightRequest="75">
                    <Border.StrokeShape>
                      <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                      <TapGestureRecognizer Tapped="OnDuration12MonthsTapped"/>
                    </Border.GestureRecognizers>
                    <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                      <StackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                        <Label Text="12 месяцев"
                               TextColor="White"
                               FontSize="17"
                               FontAttributes="Bold"/>
                        <Label x:Name="Monthly12Label"
                               Text="≈ 7 499 ₽/мес"
                               TextColor="#8E8E93"
                               FontSize="14"/>
                      </StackLayout>
                      <Label Grid.Column="1"
                             x:Name="Check12Months"
                             Text="○"
                             TextColor="#3D3D3D"
                             FontSize="28"
                             VerticalOptions="Center"/>
                    </Grid>
                  </Border>

                  <!-- 24 месяца -->
                  <Border x:Name="Duration24Months"
                          BackgroundColor="#1B1B1C"
                          Padding="18,16"
                          HeightRequest="75">
                    <Border.StrokeShape>
                      <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                      <TapGestureRecognizer Tapped="OnDuration24MonthsTapped"/>
                    </Border.GestureRecognizers>
                    <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                      <StackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                          <Label Text="24 месяца"
                                 TextColor="White"
                                 FontSize="17"
                                 FontAttributes="Bold"
                                 VerticalOptions="Center"/>
                          <Border BackgroundColor="#EF3124"
                                  Padding="6,3"
                                  VerticalOptions="Center">
                            <Border.StrokeShape>
                              <RoundRectangle CornerRadius="6"/>
                            </Border.StrokeShape>
                            <Label Text="ХИТ"
                                   TextColor="White"
                                   FontSize="10"
                                   FontAttributes="Bold"/>
                          </Border>
                        </StackLayout>
                        <Label x:Name="Monthly24Label"
                               Text="≈ 3 749 ₽/мес"
                               TextColor="#8E8E93"
                               FontSize="14"/>
                      </StackLayout>
                      <Label Grid.Column="1"
                             x:Name="Check24Months"
                             Text="○"
                             TextColor="#3D3D3D"
                             FontSize="28"
                             VerticalOptions="Center"/>
                    </Grid>
                  </Border>
                </StackLayout>

                <!-- Преимущества -->
                <Border BackgroundColor="#141417"
                        Padding="16,14"
                        Margin="0,8,0,0">
                  <Border.StrokeShape>
                    <RoundRectangle CornerRadius="14"/>
                  </Border.StrokeShape>
                  <StackLayout Spacing="10">
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                      <Label Grid.Column="0" Text="✓" TextColor="#EF3124" FontSize="18" FontAttributes="Bold" VerticalOptions="Start"/>
                      <Label Grid.Column="1"
                             Text="Без переплат и скрытых комиссий"
                             TextColor="White"
                             FontSize="13"
                             LineBreakMode="WordWrap"
                             VerticalOptions="Center"/>
                    </Grid>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                      <Label Grid.Column="0" Text="✓" TextColor="#EF3124" FontSize="18" FontAttributes="Bold" VerticalOptions="Start"/>
                      <Label Grid.Column="1"
                             Text="Можно досрочно погасить без штрафов"
                             TextColor="White"
                             FontSize="13"
                             LineBreakMode="WordWrap"
                             VerticalOptions="Center"/>
                    </Grid>
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                      <Label Grid.Column="0" Text="✓" TextColor="#EF3124" FontSize="18" FontAttributes="Bold" VerticalOptions="Start"/>
                      <Label Grid.Column="1"
                             Text="Оформление за 2 минуты онлайн"
                             TextColor="White"
                             FontSize="13"
                             LineBreakMode="WordWrap"
                             VerticalOptions="Center"/>
                    </Grid>
                  </StackLayout>
                </Border>

              </StackLayout>
            </ScrollView>
          </Grid>

          <!-- ШАГ 2: Подтверждение -->
          <Grid x:Name="InstallmentStep2Content" IsVisible="False">
            <ScrollView VerticalScrollBarVisibility="Never">
              <StackLayout Spacing="24" VerticalOptions="Start" Padding="0,0,0,20">

                <StackLayout Spacing="12">
                  <Label Text="Подтвердите заявку"
                         TextColor="White"
                         FontSize="26"
                         FontAttributes="Bold"
                         HorizontalTextAlignment="Center"/>

                  <Label Text="Проверьте данные перед отправкой"
                         TextColor="#8E8E93"
                         FontSize="15"
                         HorizontalTextAlignment="Center"/>
                </StackLayout>

                <!-- Карточка с деталями -->
                <Border BackgroundColor="#141417"
                        Padding="20,18">
                  <Border.StrokeShape>
                    <RoundRectangle CornerRadius="18"/>
                  </Border.StrokeShape>
                  <StackLayout Spacing="16">

                    <StackLayout Spacing="6">
                      <Label Text="Товар"
                             TextColor="#8E8E93"
                             FontSize="13"/>
                      <Label x:Name="ConfirmPhoneLabel"
                             Text="Смартфон"
                             TextColor="White"
                             FontSize="16"
                             FontAttributes="Bold"/>
                    </StackLayout>

                    <BoxView HeightRequest="1" BackgroundColor="#2B2B2D"/>

                    <StackLayout Spacing="6">
                      <Label Text="Стоимость"
                             TextColor="#8E8E93"
                             FontSize="13"/>
                      <Label x:Name="ConfirmPriceLabel"
                             Text="89 990 ₽"
                             TextColor="White"
                             FontSize="16"
                             FontAttributes="Bold"/>
                    </StackLayout>

                    <BoxView HeightRequest="1" BackgroundColor="#2B2B2D"/>

                    <StackLayout Spacing="6">
                      <Label Text="Срок рассрочки"
                             TextColor="#8E8E93"
                             FontSize="13"/>
                      <Label x:Name="ConfirmDurationLabel"
                             Text="24 месяца"
                             TextColor="White"
                             FontSize="16"
                             FontAttributes="Bold"/>
                    </StackLayout>

                    <BoxView HeightRequest="1" BackgroundColor="#2B2B2D"/>

                    <StackLayout Spacing="6">
                      <Label Text="Ежемесячный платёж"
                             TextColor="#8E8E93"
                             FontSize="13"/>
                      <Label x:Name="ConfirmMonthlyLabel"
                             Text="3 749 ₽"
                             TextColor="#EF3124"
                             FontSize="20"
                             FontAttributes="Bold"/>
                    </StackLayout>

                  </StackLayout>
                </Border>

                <!-- Информация -->
                <Label Text="Рассрочка 0% • Без первоначального взноса • Без переплат"
                       TextColor="#8E8E93"
                       FontSize="12"
                       HorizontalTextAlignment="Center"
                       LineBreakMode="WordWrap"/>

              </StackLayout>
            </ScrollView>
          </Grid>

          <!-- ШАГ 3: Заявка принята -->
          <Grid x:Name="InstallmentStep3Content" IsVisible="False">
            <ScrollView VerticalScrollBarVisibility="Never">
              <StackLayout Spacing="24" VerticalOptions="Center" Padding="0,20">

                <!-- Анимированная галочка -->
                <Border WidthRequest="90"
                        HeightRequest="90"
                        HorizontalOptions="Center"
                        BackgroundColor="#F0FDF4">
                  <Border.StrokeShape>
                    <RoundRectangle CornerRadius="45"/>
                  </Border.StrokeShape>
                  <Label Text="✓"
                         TextColor="#22C55E"
                         FontSize="54"
                         FontAttributes="Bold"
                         HorizontalOptions="Center"
                         VerticalOptions="Center"/>
                </Border>

                <StackLayout Spacing="12">
                  <Label Text="Заявка принята!"
                         TextColor="White"
                         FontSize="26"
                         FontAttributes="Bold"
                         HorizontalTextAlignment="Center"/>

                  <Label Text="Мы рассмотрим вашу заявку в течение 15 минут"
                         TextColor="#8E8E93"
                         FontSize="15"
                         HorizontalTextAlignment="Center"
                         LineBreakMode="WordWrap"
                         Margin="12,0"/>
                </StackLayout>

                <!-- Информационная карточка -->
                <Border BackgroundColor="#141417"
                        Padding="18,16"
                        Margin="0,8,0,0">
                  <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                  </Border.StrokeShape>
                  <StackLayout Spacing="14">
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                      <Label Grid.Column="0" Text="📱" FontSize="20" VerticalOptions="Start"/>
                      <StackLayout Grid.Column="1" Spacing="2">
                        <Label Text="Номер заявки"
                               TextColor="#8E8E93"
                               FontSize="12"/>
                        <Label x:Name="InstallmentApplicationNumberLabel"
                               Text="#2025-98765432"
                               TextColor="White"
                               FontSize="15"
                               FontAttributes="Bold"/>
                      </StackLayout>
                    </Grid>

                    <BoxView HeightRequest="1" BackgroundColor="#2B2B2D"/>

                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                      <Label Grid.Column="0" Text="⏱" FontSize="20" VerticalOptions="Start"/>
                      <StackLayout Grid.Column="1" Spacing="2">
                        <Label Text="Время рассмотрения"
                               TextColor="#8E8E93"
                               FontSize="12"/>
                        <Label Text="до 15 минут"
                               TextColor="White"
                               FontSize="15"
                               FontAttributes="Bold"/>
                      </StackLayout>
                    </Grid>

                    <BoxView HeightRequest="1" BackgroundColor="#2B2B2D"/>

                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
                      <Label Grid.Column="0" Text="🔔" FontSize="20" VerticalOptions="Start"/>
                      <StackLayout Grid.Column="1" Spacing="2">
                        <Label Text="Уведомления"
                               TextColor="#8E8E93"
                               FontSize="12"/>
                        <Label Text="Пришлем результат в push"
                               TextColor="White"
                               FontSize="15"
                               FontAttributes="Bold"/>
                      </StackLayout>
                    </Grid>
                  </StackLayout>
                </Border>

                <Label Text="Статус заявки можно отследить в разделе 'Рассрочки'"
                       TextColor="#8E8E93"
                       FontSize="13"
                       HorizontalTextAlignment="Center"
                       LineBreakMode="WordWrap"
                       Margin="12,8,12,0"/>

              </StackLayout>
            </ScrollView>
          </Grid>

        </Grid>

        <!-- Кнопка действия -->
        <Button x:Name="InstallmentActionButton"
                Grid.Row="3"
                Text="Продолжить"
                BackgroundColor="#EF3124"
                TextColor="White"
                FontSize="17"
                FontAttributes="Bold"
                CornerRadius="16"
                HeightRequest="56"
                Clicked="OnInstallmentActionButtonClicked"
                Margin="0,20,0,0"/>
      </Grid>
    </Border>

  </Grid>
</ContentPage>